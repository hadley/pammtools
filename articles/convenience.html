<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workflow and convenience functions • pammtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Workflow and convenience functions">
<meta property="og:description" content="pammtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-44545040-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-44545040-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pammtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Version">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-transformation.html">Data transformation</a>
    </li>
    <li>
      <a href="../articles/baseline.html">Estimating the baseline hazard</a>
    </li>
    <li>
      <a href="../articles/basics.html">Basic modeling</a>
    </li>
    <li>
      <a href="../articles/convenience.html">Workflow and convenience functions</a>
    </li>
    <li>
      <a href="../articles/strata.html">Stratified models</a>
    </li>
    <li>
      <a href="../articles/splines.html">Non-linear effects (penalized splines)</a>
    </li>
    <li>
      <a href="../articles/tveffects.html">Time-varying effects (TVEs)</a>
    </li>
    <li>
      <a href="../articles/frailty.html">Frailties (random effects)</a>
    </li>
    <li>
      <a href="../articles/tdcovar.html">Time-dependent covariates (TDCs)</a>
    </li>
    <li>
      <a href="../articles/model-evaluation.html">Model evaluation</a>
    </li>
    <li>
      <a href="../articles/cumulative-effects.html">Cumulative effects/Exposure-Lag-Response Associations</a>
    </li>
    <li>
      <a href="../articles/smj-tutorial.html">Paper: A generalized additive model approach to time-to-event analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adibender/pammtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Workflow and convenience functions</h1>
            
            <h4 class="date">2020-04-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adibender/pammtools/blob/master/vignettes/convenience.Rmd"><code>vignettes/convenience.Rmd</code></a></small>
      <div class="hidden name"><code>convenience.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mgcv</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pammtools</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>())</pre></body></html></div>
<p>Survival analysis entails a set of standard tasks beyond model estimation which need to be performed in most real world applications. These task include:</p>
<ul>
<li>extraction/visualization of the predicted (cumulative) hazards or survival</li>
<li>summary/visualization of estimated effects probabilities for specific covariate specifications</li>
<li>visualization of non-linear covariate effects</li>
<li>…</li>
</ul>
<p>The <strong><code>pammtools</code></strong> package provides many convenience functions to facilitate these tasks. The overall philosophy of the package is to provide functions that return the underlying data used for visualization in a <em>tidy</em> format <span class="citation">(Wickham and others <a href="#ref-wickham2014">2014</a>)</span>, such that everybody can use familiar tools for further processing. In addition, some (high level) convenience functions for visualization are also included.</p>
<p>To illustrate the usual workflow and some of the convenience functions provided by <strong><code>pammtools</code></strong>, we will use the <code>tumor</code> in the following sections. For a more complete overview see <span class="citation">Bender and Scheipl (<a href="#ref-Bender2018f">2018</a>)</span>.</p>
<div id="hazard-cumulative-hazard-and-survival-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#hazard-cumulative-hazard-and-survival-probabilities" class="anchor"></a>Hazard, cumulative hazard and survival probabilities</h2>
<p>Often one is interested in calculating the hazard, cumulative hazard or survival probability given specific values for some covariates (while other covariates are fixed at their mean values). For PAMMs, one usually also needs to create a data set where all intervals occur, in order to be able to calculate predicted values at different time points. <strong><code>pammtools</code></strong> provides a flexible interface to create such data sets (<code>make_newdata</code>) and the functions</p>
<ul>
<li><code>add_hazard</code></li>
<li>
<code>add_cumu_hazard</code> and</li>
<li><code>add_surv_prob</code></li>
</ul>
<p>to add respective predicted values (including confidence intervals) of the respective quantities. We illustrate the workflow using the <code>tumor</code> data and the model given below:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ped</span> <span class="kw">&lt;-</span> <span class="no">tumor</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span>(<span class="fu">Surv</span>(<span class="no">days</span>, <span class="no">status</span>)~ <span class="no">age</span> + <span class="no">sex</span> + <span class="no">complications</span>, <span class="kw">id</span> <span class="kw">=</span> <span class="st">"id"</span>)
<span class="no">pam</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span>(<span class="no">ped_status</span> ~ <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span>(<span class="no">tend</span>) + <span class="no">sex</span> + <span class="no">age</span> + <span class="no">complications</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">ped</span>,
  <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span>(), <span class="kw">offset</span> <span class="kw">=</span> <span class="no">offset</span>)</pre></body></html></div>
<p>In the following, we create a new data set that contains all intervals as well as mean values for all other covariates. Note that within <code>make_newdata</code> you can specify the desired covariate values by using any function applicable to the data type of the respective column. The new data will contain one row for each combination of the two variables (similar to <code>expand.grid</code>):</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ped_df</span> <span class="kw">&lt;-</span> <span class="no">ped</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/newdata.html">make_newdata</a></span>(<span class="kw">tend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">tend</span>), <span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="../reference/seq_range.html">seq_range</a></span>(<span class="no">age</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">3</span>))</pre></body></html></div>
<p>Calling the respective functions, we can add the (predicted) hazard to the newly created data.</p>
<div id="hazard" class="section level3">
<h3 class="hasAnchor">
<a href="#hazard" class="anchor"></a>Hazard</h3>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ped_df</span> <span class="kw">&lt;-</span> <span class="no">ped_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/add_hazard.html">add_hazard</a></span>(<span class="no">pam</span>)
<span class="no">ped_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span>(<span class="no">interval</span>, <span class="no">hazard</span>, <span class="no">ci_lower</span>, <span class="no">ci_upper</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></body></html></div>
<pre><code>##   interval       hazard     ci_lower     ci_upper
## 1    (0,1] 0.0001955248 0.0001095045 0.0003491175
## 2    (1,2] 0.0001952127 0.0001093736 0.0003484204
## 3    (2,3] 0.0001949011 0.0001092426 0.0003477254
## 4    (3,5] 0.0001942794 0.0001089804 0.0003463418
## 5    (5,6] 0.0001939693 0.0001088492 0.0003456532
## 6    (6,7] 0.0001936596 0.0001087179 0.0003449668</code></pre>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">ped_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span>(<span class="no">interval</span>, <span class="no">hazard</span>, <span class="no">ci_lower</span>, <span class="no">ci_upper</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>()</pre></body></html></div>
<pre><code>##        interval       hazard     ci_lower    ci_upper
## 973 (2393,2443] 0.0006260640 0.0003516509 0.001114617
## 974 (2443,2488] 0.0006009808 0.0003308557 0.001091648
## 975 (2488,2588] 0.0005464595 0.0002854032 0.001046302
## 976 (2588,2595] 0.0005427429 0.0002822783 0.001043544
## 977 (2595,2808] 0.0004382256 0.0001914665 0.001003004
## 978 (2808,3034] 0.0003472230 0.0001127654 0.001069155</code></pre>
<p>Which in turn can be conveniently plotted using respective functions, e.g.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">ped_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">tend</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">age</span>)) +
    <span class="fu"><a href="../reference/geom_hazard.html">geom_stephazard</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">hazard</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">age</span>)) +
    <span class="fu"><a href="../reference/geom_stepribbon.html">geom_stepribbon</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ci_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ci_upper</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">age</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.2</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hat</a></span>(<span class="no">lambda</span>)(<span class="no">t</span>))) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">t</span>))</pre></body></html></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-6-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="hazard-ratio" class="section level3">
<h3 class="hasAnchor">
<a href="#hazard-ratio" class="anchor"></a>Hazard Ratio</h3>
<p>The hazard ratio can be calculated by specifying the <code>reference</code> argument:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"># the code below gives hazard reatio of a 30 year old relative to a 58 year old (cp)
# ped %&gt;%
#   make_newdata(age = c(30)) %&gt;%
#   add_hazard(pam, reference = list(age = c(58))) %&gt;%
#   select(hazard, ci_lower, ci_upper)
# -&gt; 30 year old has about half the risk of a 58 year old</pre></body></html></div>
<p>This might seem a little convoluted, but can be easily generalized in case of time-varying effects, time-dependent covariates, cumulative effects, etc.</p>
</div>
<div id="cumulative-hazard" class="section level3">
<h3 class="hasAnchor">
<a href="#cumulative-hazard" class="anchor"></a>Cumulative hazard</h3>
<p>Analogously, we can obtain the cumulative hazard (piece-wise linear function). Note that for the cumulative hazard and survival probability it is <strong>important to group the data</strong> accordingly, such that the cumulative hazard is cumulated for each value of the grouping variable. Otherwise it would be cumulated over the whole data set (which is usually not intended, except if the specified variable is a time-dependent covariate).</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">ped_df</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span>(<span class="no">age</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/add_hazard.html">add_cumu_hazard</a></span>(<span class="no">pam</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">tend</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">cumu_hazard</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">cumu_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">cumu_upper</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">age</span>)) +
    <span class="fu"><a href="../reference/geom_hazard.html">geom_hazard</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">col</span> <span class="kw">=</span> <span class="no">age</span>)) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">age</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.2</span>) +
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hat</a></span>(<span class="no">Lambda</span>)(<span class="no">t</span>))) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">t</span>))</pre></body></html></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-8-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="survival-probability" class="section level3">
<h3 class="hasAnchor">
<a href="#survival-probability" class="anchor"></a>Survival probability</h3>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">ped_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span>(<span class="no">age</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/add_surv_prob.html">add_surv_prob</a></span>(<span class="no">pam</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">tend</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">surv_prob</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">surv_lower</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">surv_upper</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">age</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">col</span> <span class="kw">=</span> <span class="no">age</span>)) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">age</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hat</a></span>(<span class="no">S</span>)(<span class="no">t</span>))) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">t</span>))</pre></body></html></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-9-1.png" width="384" style="display: block; margin: auto;"></p>
<p>This approach is very convenient, as it can be extended to arbitrary covariate specifications:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">ped_df_sex</span> <span class="kw">&lt;-</span> <span class="no">ped</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/newdata.html">make_newdata</a></span>(<span class="kw">tend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">tend</span>), <span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="../reference/seq_range.html">seq_range</a></span>(<span class="no">age</span>, <span class="fl">3</span>),
    <span class="kw">complications</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">complications</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span>(<span class="no">complications</span>, <span class="no">age</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/add_surv_prob.html">add_surv_prob</a></span>(<span class="no">pam</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">ped_df_sex</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">tend</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">surv_prob</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">age</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">surv_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">surv_upper</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">age</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.3</span>) +
  <span class="fu"><a href="../reference/geom_hazard.html">geom_surv</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">col</span> <span class="kw">=</span> <span class="no">age</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hat</a></span>(<span class="no">S</span>)(<span class="no">t</span>))) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">t</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">complications</span>, <span class="kw">labeller</span> <span class="kw">=</span> <span class="no">label_both</span>)</pre></body></html></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="visualization-of-non-linear-covariate-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization-of-non-linear-covariate-effects" class="anchor"></a>Visualization of non-linear covariate effects</h2>
<p>Data sets for the visualization of the (non-linear) effect of a continuous covariates can be created in a similar fashion. For illustration, we add a non-linear age effect to the previous model (see also high level functions<code><a href="../reference/gg_smooth.html">?gg_smooth</a></code> and <code><a href="../reference/gg_tensor.html">?gg_tensor</a></code> and <code>gg_re</code> for <code><a href="https://rdrr.io/pkg/mgcv/man/plot.gam.html">mgcv::plot.gam</a></code> like plots):</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">ped</span> <span class="kw">&lt;-</span> <span class="no">tumor</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span>(<span class="fu">Surv</span>(<span class="no">days</span>, <span class="no">status</span>)~ <span class="no">age</span> + <span class="no">sex</span> + <span class="no">complications</span> +
  <span class="no">charlson_score</span>, <span class="kw">id</span> <span class="kw">=</span> <span class="st">"id"</span>)
<span class="no">pam</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span>(<span class="no">ped_status</span> ~ <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span>(<span class="no">tend</span>) + <span class="no">sex</span> + <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span>(<span class="no">age</span>) + <span class="no">complications</span> ,
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">ped</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span>(), <span class="kw">offset</span> <span class="kw">=</span> <span class="no">offset</span>)</pre></body></html></div>
<p>Using <code>make_newdata</code> and <code>add_term</code> we obtain:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">term_charlson</span> <span class="kw">&lt;-</span> <span class="no">ped</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/newdata.html">make_newdata</a></span>(<span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="../reference/seq_range.html">seq_range</a></span>(<span class="no">age</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">25</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/add_term.html">add_term</a></span>(<span class="no">pam</span>, <span class="kw">term</span> <span class="kw">=</span> <span class="st">"age"</span>, <span class="kw">reference</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">.</span>$<span class="no">age</span>)))
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">term_charlson</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">age</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">fit</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ci_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ci_upper</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.2</span>)</pre></body></html></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-12-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Similarly, we could use high level function <code>gg_slice</code> to obtain the estimated effect of the age variable, relative to the mean age and age of 30, respectively:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="../reference/gg_slice.html">gg_slice</a></span>(<span class="no">ped</span>, <span class="no">pam</span>, <span class="st">"age"</span>, <span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="../reference/seq_range.html">seq_range</a></span>(<span class="no">age</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">25</span>),
  <span class="kw">reference</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">ped</span>$<span class="no">age</span>)))</pre></body></html></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-13-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="../reference/gg_slice.html">gg_slice</a></span>(<span class="no">ped</span>, <span class="no">pam</span>, <span class="st">"age"</span>, <span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="../reference/seq_range.html">seq_range</a></span>(<span class="no">age</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">25</span>),
  <span class="kw">reference</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">30</span>)))</pre></body></html></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-13-2.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Bender2018f">
<p>Bender, Andreas, and Fabian Scheipl. 2018. “Pammtools: Piece-Wise Exponential Additive Mixed Modeling Tools.” <em>arXiv:1806.01042 [Stat]</em>. <a href="http://arxiv.org/abs/1806.01042" class="uri">http://arxiv.org/abs/1806.01042</a>.</p>
</div>
<div id="ref-wickham2014">
<p>Wickham, Hadley, and others. 2014. “Tidy Data.” <em>Journal of Statistical Software</em> 59 (10): 1–23.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andreas Bender, Fabian Scheipl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'c3726dcbf089f0b26f496305ed030c22',
    indexName: 'pammtools',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
